<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PIC32CX-BZ Zigbee API Reference: System Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PIC32CX-BZ Zigbee API Reference</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">System Environment </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>The System Environment component is used to maintain task management mechanism, which distributes execution time between stack components and the application, and events system.</p>
<p><span class="table_of_contents">References</span> </p>
<ul>
<li>
<a class="el" href="group__sys.html">System Environment functions</a> </li>
</ul>
 
<hr style="border-top:1px solid #E0E0FF; margin-top:10px"/>

<span class="table_of_contents">Contents</span>
<ul class="table_of_contents">
  <li><a href="#tasks">Tasks management</a></li>
  <li><a href="#events">Events managements</a></li>
</ul>
<p></p>
 <span class="to_top"><a href="#">Back to top</a></span>  <h2><a class="anchor" id="tasks"></a>
Tasks management</h2>
<p>The application may use two functions two manage task execution. The <a class="el" href="group__sys.html#ga445f4a39e0b3cb95bf80ed93867b0ebc" title="This function is called by the stack or from the main() function to process tasks.">SYS_RunTask()</a> function shal be called in the infinite loop inside the <code>main()</code> function to instruct the stack to process the next task. The stack checks what components have posted tasks via the <a class="el" href="group__sys.html#ga19cb63c28d94c2870db54ef53ba2ccd3" title="Posts a task to the task manager, which is later processed by the task handler of the corresponding s...">SYS_PostTask()</a> function and executes them according to priority of components. The application has the least priority, and so its tasks are executed only after tasks of all other components are executed. Executing a tasks means calling the <a class="el" href="programming_basics.html#task_handlers">task handler</a> function of the correspondent component.</p>
<p>A task handler function implements the state machine of the component, selecting the code to execute according to the current state. The <a class="el" href="programming_basics.html#def_task_exec">application task handler</a> is the <a class="el" href="sys_task_manager_8h.html#aec14264f3afa11a970347e765c44d9ef">APL_TaskHandler()</a> function.</p>
 <span class="to_top"><a href="#">Back to top</a></span>  <h2><a class="anchor" id="events"></a>
Events management</h2>
<p>Events are used throughout the stack and may also be employed by the application. The application may add its own handlers to be executed upon events used by the stack.</p>
<p>Events used by the stack are defined in the <code>\Components\ZDO\include\bcEvents.h</code> file. The maximum number of events that may be supported by the System Environment component is given by <a class="el" href="sys_events_handler_8h.html#a74e14cf27b9165b75144269cc9050eec">SYS_MAX_EVENTS</a>. Each event may have several subscribers (handlers) associated with callback functions called one by one when the event is raised.</p>
<p>To subscribe to event call the <a class="el" href="group__sys.html#gad3b5e21c529ba6292086924bab7a0019" title="Subscribe a receiver to an event. The same receiver may be subscribed to multiple events by calling t...">SYS_SubscribeToEvent()</a> function, supplying event ID of the <a class="el" href="sys_events_handler_8h.html#a898ca337a850ef959f88839c2fbf9263" title="The type for event identifier.">SYS_EventId_t</a> type and the pointer to instance of the <a class="el" href="sys_events_handler_8h.html#a31ed8976c65838f156b600f1c6c9fb5b" title="Structure for declaring an event receiver.">SYS_EventReceiver_t</a> type. The latter instance must be defined statically (or globally). The <code>func</code> field of the instance is set to the pointer to a callback function, which is executed when the event is raised. For example:</p>
<div class="fragment"><pre class="fragment"><span class="comment">//The callback function for the event</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> eventCallback(<a class="code" href="sys_events_handler_8h.html#a898ca337a850ef959f88839c2fbf9263" title="The type for event identifier.">SYS_EventId_t</a> eventId, <a class="code" href="sys_events_handler_8h.html#aefb71906387c48034372f851717b8c02">SYS_EventData_t</a> data)
{
  ...
}

<span class="comment">//Defined globally</span>
<a class="code" href="struct___s_y_s___event_receiver__t.html" title="Structure for declaring an event receiver.">SYS_EventReceiver_t</a> eventReceiver = { .<a class="code" href="struct___s_y_s___event_receiver__t.html#a2057269e60023f6638b866908f339d73">func</a> = eventCallback };

...
<span class="comment">//Subscribe to the event with the EVENT_ID identifier (substitute with any</span>
<span class="comment">//ID code from the BcEvents_t enumeration</span>
SYS_SubscribeToEvent(EVENT_ID, &amp;eventReceiver);
</pre></div><p>Once a subscriber is added to the event, associating a callback function with it, the event may be raised by calling the <a class="el" href="group__sys.html#gade68a4c2466367fc93b3aaafb1794543" title="Post an event to be delivered to all subscribed receivers.">SYS_PostEvent()</a> function. The function is supplied with the event's ID (the first argument) and arbitrary data of the <a class="el" href="sys_events_handler_8h.html#aefb71906387c48034372f851717b8c02">SYS_EventData_t</a> type (the second argument), which is passed to the event's callback function as the callback's <code>data</code> argument. If no data shall be passed to the callback set the second argument to 0. See the types of data passed with events within BcEvents_t enumeration's description. To pass the pointer to a structure, cast the pointer to the <code>uintptr_t</code> type. For example: </p>
<div class="fragment"><pre class="fragment"><span class="comment">//The EventData_t type is supposed to be a type specific to the event that is raised</span>
<span class="keyword">static</span> EventData_t eventData;
...
SYS_PostEvent(EVENT_ID, (uintptr_t)&amp;eventData);
</pre></div><p>A handler may be removed from an event by calling the <a class="el" href="group__sys.html#ga4be8fbc87bb14f286dc4cdd13eefcd39" title="Unsubscribe a receiver from an event.">SYS_UnsubscribeFromEvent()</a> function, supplying it with the same values that were passed to <a class="el" href="group__sys.html#gad3b5e21c529ba6292086924bab7a0019" title="Subscribe a receiver to an event. The same receiver may be subscribed to multiple events by calling t...">SYS_SubscribeToEvent()</a> function when the handler was added to the event. It is also possible to check if an event has any subscribers - call the <a class="el" href="group__sys.html#gacad3111d0f69a7095b87add5f765d357" title="Check if event have at least one subscriber.">SYS_IsEventDeliverable()</a> function - and to check if a given receiver instance (of the <a class="el" href="sys_events_handler_8h.html#a31ed8976c65838f156b600f1c6c9fb5b" title="Structure for declaring an event receiver.">SYS_EventReceiver_t</a> type) was subscribed to a given event. </p>
</div></div>
<hr style="border-top:1px solid #C4CFE5; margin-top:20px"/>
</body>
</html>
