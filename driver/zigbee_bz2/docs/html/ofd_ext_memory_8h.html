<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PIC32CX-BZ Zigbee API Reference: ofdExtMemory.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PIC32CX-BZ Zigbee API Reference</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ofdExtMemory.h File Reference</div>  </div>
</div>
<div class="contents">

<p>The public API of external flash driver.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="sys_types_8h_source.html">sysTypes.h</a>&gt;</code><br/>
</div>
<p><a href="ofd_ext_memory_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_o_f_d___memory_access_param__t.html">OFD_MemoryAccessParam_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameters for access to the external memory <br/>
 offset - offset from start address <br/>
 data - pointer to MCU RAM area with data for external memory <br/>
 length - size of MCU RAM area with data.  <a href="struct_o_f_d___memory_access_param__t.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_o_f_d___image_info__t.html">OFD_ImageInfo_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Image information: crc and image type.  <a href="struct_o_f_d___image_info__t.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac74fc073c430606b0defea72021b0078"></a><!-- doxytag: member="ofdExtMemory.h::OFD_BLOCK_SIZE_FOR_CHECK_CRC" ref="ac74fc073c430606b0defea72021b0078" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#ac74fc073c430606b0defea72021b0078">OFD_BLOCK_SIZE_FOR_CHECK_CRC</a>&#160;&#160;&#160;64</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of a memory block for internal OFD algorithms. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>OFD_BLOCK_SIZE</b></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aab5f7fd7465294cbbb0f44ecaa9ad09c"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Crc_t" ref="aab5f7fd7465294cbbb0f44ecaa9ad09c" args="" -->
typedef uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#aab5f7fd7465294cbbb0f44ecaa9ad09c">OFD_Crc_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Image crc. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acd48e7c8e21a59445ab93d35f8721f9e"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Callback_t" ref="acd48e7c8e21a59445ab93d35f8721f9e" args=")(OFD_Status_t)" -->
typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> )(<a class="el" href="ofd_ext_memory_8h.html#a7279f2deb920e6a1cef79a3fcb228f16">OFD_Status_t</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">callback signatures for the OFD API. ATTENTION!!! Callback functions must not call OFD public API directly. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a49fbd29a5807dfc9a5c12e2da08a88e4"></a><!-- doxytag: member="ofdExtMemory.h::OFD_InfoCallback_t" ref="a49fbd29a5807dfc9a5c12e2da08a88e4" args=")(OFD_Status_t, OFD_ImageInfo_t *)" -->
typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><b>OFD_InfoCallback_t</b> )(<a class="el" href="ofd_ext_memory_8h.html#a7279f2deb920e6a1cef79a3fcb228f16">OFD_Status_t</a>, <a class="el" href="struct_o_f_d___image_info__t.html">OFD_ImageInfo_t</a> *)</td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a7279f2deb920e6a1cef79a3fcb228f16">OFD_Status_t</a> { <br/>
&#160;&#160;<b>OFD_STATUS_SUCCESS</b> =  0, 
<br/>
&#160;&#160;<b>OFD_STATUS_SERIAL_BUSY</b>, 
<br/>
&#160;&#160;<b>OFD_STATUS_UNKNOWN_EXTERNAL_FLASH_TYPE</b>, 
<br/>
&#160;&#160;<b>OFD_STATUS_INCORRECT_API_PARAMETER</b>, 
<br/>
&#160;&#160;<b>OFD_STATUS_INCORRECT_EEPROM_PARAMETER</b>, 
<br/>
&#160;&#160;<b>OFD_SERIAL_INTERFACE_BUSY</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Status messages for upper component about the OFD state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> { <br/>
&#160;&#160;<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681aa3de8d67d2f18325b457e21208c2b98a">OFD_POSITION_1</a>, 
<br/>
&#160;&#160;<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681aa2af8539b43abfdce8fe564b9a49bba6">OFD_POSITION_2</a>, 
<br/>
&#160;&#160;<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681aee22ef27dc3a39f95b32a27536357b53">OFD_POSITION_MAX</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of an image's position in the external flash.  <a href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a956dd3b2ecd1badbd822dd86498e6428">OFD_ImageSource_t</a> { <br/>
&#160;&#160;<b>OFD_IMAGE_WAS_SAVED_FROM_MCU</b>, 
<br/>
&#160;&#160;<b>OFD_IMAGE_WAS_WRITTEN_THROUGH_API</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Source type which has been initiator of image saving. <br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a5ffe24e3890504c4fea3191d456a80f7">OFD_Open</a> (<a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens the serial interface for connection with the external memory and checks memory type.  <a href="#a5ffe24e3890504c4fea3191d456a80f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#ac6067c5f2ebb87d6b84790ab2f054d63">OFD_Close</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes the serial interface opened using <a class="el" href="ofd_ext_memory_8h.html#a5ffe24e3890504c4fea3191d456a80f7" title="Opens the serial interface for connection with the external memory and checks memory type...">OFD_Open()</a>  <a href="#ac6067c5f2ebb87d6b84790ab2f054d63"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a12770665330f3f6fa951e82df89c5662">OFD_EraseImage</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> pos, <a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases an image at a given position in the external memory.  <a href="#a12770665330f3f6fa951e82df89c5662"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#ae4e68cfaace571c27be7cf3c8ee0c016">OFD_Write</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> pos, <a class="el" href="struct_o_f_d___memory_access_param__t.html">OFD_MemoryAccessParam_t</a> *accessParam, <a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes data to the external memory.  <a href="#ae4e68cfaace571c27be7cf3c8ee0c016"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a2889dc3238b68d98c312b1fc9aa1bdff">OFD_Read</a> (uint32_t address, uint8_t *data, uint16_t size, <a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads data from the external memory.  <a href="#a2889dc3238b68d98c312b1fc9aa1bdff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a9bd01d19510a8780cc3e209c43e493e5">OFD_FlushAndCheckCrc</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> pos, uint8_t *countBuff, OFD_InfoCallback_t cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Flushes data from the internal buffer, checks image's crc and saves it to the external memory.  <a href="#a9bd01d19510a8780cc3e209c43e493e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a8979297ab669f311a19d6301078df5f4">OFD_SwitchToNewImage</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> whereToSave, <a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> from, uint8_t *copyBuff, <a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the MCU's current application image and EEPROM to the external memory, checks crc for it and sets the command for bootloader.  <a href="#a8979297ab669f311a19d6301078df5f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a474b54ead3d059ab540453948ea0da14">OFD_ChangeImage</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> from, <a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a> cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a command for bootloader that the new image can replace the old one.  <a href="#a474b54ead3d059ab540453948ea0da14"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a303497268fa2dea494f63dc21d14fd5b">OFD_ReadImageInfo</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> pos, OFD_InfoCallback_t cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads information about the image.  <a href="#a303497268fa2dea494f63dc21d14fd5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd_ext_memory_8h.html#a7b492c9c256138cc783bc723eb13a902">OFD_CalCrc</a> (<a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a> pos, uint8_t *countBuff, uint32_t length, uint8_t expCrc, OFD_InfoCallback_t cb)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">calculates image crc, saves it to eeprom. returns the crc to the caller. There will be an unnecessary EEPROM write at the end. But this should not create any side effect as it would get overwritten by a new CRC before the real image switch  <a href="#a7b492c9c256138cc783bc723eb13a902"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The public API of external flash driver. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Microchip Corporation: <a href="http://www.microchip.com">http://www.microchip.com</a> <br/>
 Support email: <a href="mailto:support@microchip.com">support@microchip.com</a></dd></dl>
<p>Copyright (c) 2018, Microchip Corporation. All rights reserved. Licensed under Mirochip's Limited License Agreement. </p>

<p>Definition in file <a class="el" href="ofd_ext_memory_8h_source.html">ofdExtMemory.h</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="aba671011383391a67226c68d1df75f32"></a><!-- doxytag: member="ofdExtMemory.h::OFD_BLOCK_SIZE" ref="aba671011383391a67226c68d1df75f32" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OFD_BLOCK_SIZE</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(APS_MAX_NON_SECURITY_ASDU_SIZE \
          - ZCL_IMAGE_BLOCK_RESP_HEADER_SIZE - ZCL_FRAME_STANDARD_HEADER_SIZE)
</pre></div>
<p>Definition at line <a class="el" href="ofd_ext_memory_8h_source.html#l00031">31</a> of file <a class="el" href="ofd_ext_memory_8h_source.html">ofdExtMemory.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a5cedc1206b8397e1a2cb04289ebac681"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Position_t" ref="a5cedc1206b8397e1a2cb04289ebac681" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The number of an image's position in the external flash. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a5cedc1206b8397e1a2cb04289ebac681aa3de8d67d2f18325b457e21208c2b98a"></a><!-- doxytag: member="OFD_POSITION_1" ref="a5cedc1206b8397e1a2cb04289ebac681aa3de8d67d2f18325b457e21208c2b98a" args="" -->OFD_POSITION_1</em>&nbsp;</td><td>
<p>The first image position. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a5cedc1206b8397e1a2cb04289ebac681aa2af8539b43abfdce8fe564b9a49bba6"></a><!-- doxytag: member="OFD_POSITION_2" ref="a5cedc1206b8397e1a2cb04289ebac681aa2af8539b43abfdce8fe564b9a49bba6" args="" -->OFD_POSITION_2</em>&nbsp;</td><td>
<p>The second image position. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a5cedc1206b8397e1a2cb04289ebac681aee22ef27dc3a39f95b32a27536357b53"></a><!-- doxytag: member="OFD_POSITION_MAX" ref="a5cedc1206b8397e1a2cb04289ebac681aee22ef27dc3a39f95b32a27536357b53" args="" -->OFD_POSITION_MAX</em>&nbsp;</td><td>
<p>The total number of available positions. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="ofd_ext_memory_8h_source.html#l00049">49</a> of file <a class="el" href="ofd_ext_memory_8h_source.html">ofdExtMemory.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5ffe24e3890504c4fea3191d456a80f7"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Open" ref="a5ffe24e3890504c4fea3191d456a80f7" args="(OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_Open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Opens the serial interface for connection with the external memory and checks memory type. </p>
<p>The serial interface captured by executing this function may not be used until <a class="el" href="ofd_ext_memory_8h.html#ac6067c5f2ebb87d6b84790ab2f054d63" title="Closes the serial interface opened using OFD_Open()">OFD_Close()</a> is called.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function called once the interface is opened; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac6067c5f2ebb87d6b84790ab2f054d63"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Close" ref="ac6067c5f2ebb87d6b84790ab2f054d63" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_Close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Closes the serial interface opened using <a class="el" href="ofd_ext_memory_8h.html#a5ffe24e3890504c4fea3191d456a80f7" title="Opens the serial interface for connection with the external memory and checks memory type...">OFD_Open()</a> </p>
<p>The function releases the serial interface that has been opened to read from and write to the external memory. The function is required if the serial interface is going to be used by other components. </p>

</div>
</div>
<a class="anchor" id="a12770665330f3f6fa951e82df89c5662"></a><!-- doxytag: member="ofdExtMemory.h::OFD_EraseImage" ref="a12770665330f3f6fa951e82df89c5662" args="(OFD_Position_t pos, OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_EraseImage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Erases an image at a given position in the external memory. </p>
<p>The function must be called the specified image position in the external memory before writing the new image to this position.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position in the external memory </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function called once the image is completely erased; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae4e68cfaace571c27be7cf3c8ee0c016"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Write" ref="ae4e68cfaace571c27be7cf3c8ee0c016" args="(OFD_Position_t pos, OFD_MemoryAccessParam_t *accessParam, OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_Write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_o_f_d___memory_access_param__t.html">OFD_MemoryAccessParam_t</a> *&#160;</td>
          <td class="paramname"><em>accessParam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes data to the external memory. </p>
<p>The function writes a piece of the new image (specified by its image position <code>pos</code>) at a given offset to the external memory.</p>
<p>The function can be called for the first time only after the serial interface has been opened by <a class="el" href="ofd_ext_memory_8h.html#a5ffe24e3890504c4fea3191d456a80f7" title="Opens the serial interface for connection with the external memory and checks memory type...">OFD_Open()</a> and the memory at the specified image position has been erased by <a class="el" href="ofd_ext_memory_8h.html#a12770665330f3f6fa951e82df89c5662" title="Erases an image at a given position in the external memory.">OFD_EraseImage()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position of the new image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accessParam</td><td>- pointer to the structure containing: data offset, pointer to the buffer with the received data, and its length. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a2889dc3238b68d98c312b1fc9aa1bdff"></a><!-- doxytag: member="ofdExtMemory.h::OFD_Read" ref="a2889dc3238b68d98c312b1fc9aa1bdff" args="(uint32_t address, uint8_t *data, uint16_t size, OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_Read </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads data from the external memory. </p>
<p>The function reads a piece of the data (specified by its image position <code>pos</code>) at a given offset to the external memory.</p>
<p>The function can be called for the first time only after the serial interface has been opened by <a class="el" href="ofd_ext_memory_8h.html#a5ffe24e3890504c4fea3191d456a80f7" title="Opens the serial interface for connection with the external memory and checks memory type...">OFD_Open()</a> and the memory at the specified image position has been erased by <a class="el" href="ofd_ext_memory_8h.html#a12770665330f3f6fa951e82df89c5662" title="Erases an image at a given position in the external memory.">OFD_EraseImage()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position of the data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">accessParam</td><td>- pointer to the structure containing: data offset, pointer to the buffer with the received data, and its length. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9bd01d19510a8780cc3e209c43e493e5"></a><!-- doxytag: member="ofdExtMemory.h::OFD_FlushAndCheckCrc" ref="a9bd01d19510a8780cc3e209c43e493e5" args="(OFD_Position_t pos, uint8_t *countBuff, OFD_InfoCallback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_FlushAndCheckCrc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>countBuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OFD_InfoCallback_t&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flushes data from the internal buffer, checks image's crc and saves it to the external memory. </p>
<p>The function is called to write the rest of the new image from the internal buffer to the external memory. The function also checks image's crc, using the buffer pointed by <code>countBuff</code> to store temporary data, and saves it to the external memory.</p>
<p>Once the function completes these operations, the callback function is called. The <a class="el" href="ofd_ext_memory_8h.html#a8979297ab669f311a19d6301078df5f4" title="Saves the MCU&#39;s current application image and EEPROM to the external memory, checks crc for it and se...">OFD_SwitchToNewImage()</a> function may be called next to prepare the image for transition to the MCU's flash and setting a command for bootloader.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position of the new image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">countBuff</td><td>- pointer to the memory for storing temporary data during function's execution (the buffer be of the OFD_BLOCK_SIZE_FOR_CHECK_CRC length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8979297ab669f311a19d6301078df5f4"></a><!-- doxytag: member="ofdExtMemory.h::OFD_SwitchToNewImage" ref="a8979297ab669f311a19d6301078df5f4" args="(OFD_Position_t whereToSave, OFD_Position_t from, uint8_t *copyBuff, OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_SwitchToNewImage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>whereToSave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>copyBuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Saves the MCU's current application image and EEPROM to the external memory, checks crc for it and sets the command for bootloader. </p>
<p>The function prepares the MCU to switch to the new application image. Current image is copied to the external memory at the specified image position (given by <code>whereToSave</code>), and a command is set for bootloader that the new image (from position given by <code>from</code>) should be written to the MCU's internal flash. The bootloader receives control after hardware reset and writes the new image to the flash.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">whereToSave</td><td>- image position where the MCU's current image and EEPROM should be saved </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">from</td><td>- image position of the new image in the external memory </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">copyBuff</td><td>- pointer to the memory for storing temporary data during function's execution (the buffer be of the OFD_BLOCK_SIZE_FOR_CHECK_CRC length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to a callback function indicating that the function has completed; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a474b54ead3d059ab540453948ea0da14"></a><!-- doxytag: member="ofdExtMemory.h::OFD_ChangeImage" ref="a474b54ead3d059ab540453948ea0da14" args="(OFD_Position_t from, OFD_Callback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_ChangeImage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#acd48e7c8e21a59445ab93d35f8721f9e">OFD_Callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets a command for bootloader that the new image can replace the old one. </p>
<p>This is an obsolete function. The <a class="el" href="ofd_ext_memory_8h.html#a8979297ab669f311a19d6301078df5f4" title="Saves the MCU&#39;s current application image and EEPROM to the external memory, checks crc for it and se...">OFD_SwitchToNewImage()</a> function should be used instead.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">from</td><td>- image position </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to callback; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a303497268fa2dea494f63dc21d14fd5b"></a><!-- doxytag: member="ofdExtMemory.h::OFD_ReadImageInfo" ref="a303497268fa2dea494f63dc21d14fd5b" args="(OFD_Position_t pos, OFD_InfoCallback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_ReadImageInfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OFD_InfoCallback_t&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads information about the image. </p>
<p>This is an obsolete function. Should not be used.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to callback; must not be set to NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7b492c9c256138cc783bc723eb13a902"></a><!-- doxytag: member="ofdExtMemory.h::OFD_CalCrc" ref="a7b492c9c256138cc783bc723eb13a902" args="(OFD_Position_t pos, uint8_t *countBuff, uint32_t length, uint8_t expCrc, OFD_InfoCallback_t cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OFD_CalCrc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ofd_ext_memory_8h.html#a5cedc1206b8397e1a2cb04289ebac681">OFD_Position_t</a>&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>countBuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>expCrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OFD_InfoCallback_t&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>calculates image crc, saves it to eeprom. returns the crc to the caller. There will be an unnecessary EEPROM write at the end. But this should not create any side effect as it would get overwritten by a new CRC before the real image switch </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>- image position for new data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">countBuff</td><td>- pointer to the memory for internal data (memory size must be OFD_BLOCK_SIZE_FOR_CHECK_CRC) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>- length of the countBuff parameter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">expCrc</td><td>- expected CRC </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- pointer to callback </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div>
<hr style="border-top:1px solid #C4CFE5; margin-top:20px"/>
</body>
</html>
