<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="BDB Commissioning" />
<meta name="DC.relation" scheme="URI" content="GUID-FC956B9D-553C-4CEF-B7C2-73CCE741705B.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>BDB Commissioning</title>
<meta name="Microsoft.Help.Id" content="GUID-1DD68C79-8AC2-497D-A1BB-49D92D3FDAB8-GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3" />
<meta name="Microsoft.Help.TocParent" content="GUID-1DD68C79-8AC2-497D-A1BB-49D92D3FDAB8-GUID-FC956B9D-553C-4CEF-B7C2-73CCE741705B" />
<meta name="Microsoft.Help.TocOrder" content="1" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB Harmony Wireless Zigbee Reference 3 08/2023" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3">
<h1 class="title topictitle1" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-E45521AF-CAAA-4614-8683-9E4DDCDFFF87" style="">BDB Commissioning</h1><div class="body"><p class="p">Commissioning is executed based on the option specified in mode (parameter). The different commissioning modes are touchlink commissioning , network steering, network formation and finding &amp; binding. Only one of these modes shall be set while calling this API, and that particular commisioning procedure will be started.</p>
<p class="p">Commissioning is invoked by application using the below Public API </p>
<pre class="pre">bool <a class="xref" href="GUID-AC994CE6-82C3-4862-B635-3F4420E55647.html">BDB_InvokeCommissioning</a> (<a class="xref" href="GUID-39D5E1EB-9EF6-4F9E-B360-F0FE642B7DC8.html">BDB_InvokeCommissioningReq_t</a> *req);</pre>
<p class="p"><strong class="ph b">Parameters:</strong></p>

    <p class="p"><a class="xref" href="GUID-39D5E1EB-9EF6-4F9E-B360-F0FE642B7DC8.html">BDB_InvokeCommissioningReq_t</a> is request structure has the following elements to be
      filled  </p>
<ul class="ul" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__UL_AKP_QLV_3TB"><li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-77DA4B89-AD73-48E2-B560-5606C432E0AD">mode - selected commissioning procedure to execute.</li>
<li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-077F0780-FE3D-42F4-B6F6-1FEE432E8143">initiatorReq - <p class="p">Parameters used in f&amp;b and
          touchlink. Ignore if touchlink or finding and binding is</p>
<p class="p"> not set in mode</p>
</li>

      <li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-726D603A-973B-4A81-B250-6ECC78A6EFE2">confirm - Parameters of the confirm being returned in BDB_InvokeCommissioningConf() </li>
<li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-BB334DDF-5612-4A0F-87EF-8E48F32C89FD">BDB_InvokeCommissioningConf - Commissioning
        completion callback with commissioning status</li>
</ul>
<p class="p">Touchlink Commissioning is invoked by application using the Public API BDB_InvokeCommissioning() The following example illustrates the touchlink process:</p>
<pre class="pre">// parameters for commissioning request
<a class="xref" href="GUID-39D5E1EB-9EF6-4F9E-B360-F0FE642B7DC8.html">BDB_InvokeCommissioningReq_t</a> AppbdbCommissioningreq;

//BDB invoke commissioning callback
static void touchlinkCallback(<a class="xref" href="GUID-99E23F3C-7041-4537-8289-FAACDC5BE3C4.html">BDB_InvokeCommissioningConf_t</a> *conf)
{
  ...
}
// Fill the commissioning request with mode, endpoint, clutser details and a // callback to be called after commissioning.
//#define BDB_COMMISSIONING_TOUCHLINK       0 
//#define BDB_COMMISSIONING_NWK_STEERING    1
//#define BDB_COMMISSIONING_NWK_FORMATION   2   
//#define BDB_COMMISSIONING_FINDING_BINDING 3

AppbdbCommissioningreq.mode = BDB_COMMISSIONING_TOUCHLINK; // select one of the above list
AppbdbCommissioningreq.initiatorReq-&gt;initiatorEndpoint = srcEndpoint;
AppbdbCommissioningreq.initiatorReq-&gt;clientClustersCount = remoteServersCnt;
AppbdbCommissioningreq.initiatorReq-&gt;serverClustersCount = remoteClientsCnt;
AppbdbCommissioningreq.initiatorReq-&gt;clientClustersList= deviceServers;
AppbdbCommissioningreq.initiatorReq-&gt;serverClustersList= deviceClients;

AppbdbCommissioningreq.BDB_InvokeCommissioningConf = commissioningDoneCallback;
// Start commissioning procedure
<a class="xref" href="GUID-AC994CE6-82C3-4862-B635-3F4420E55647.html">BDB_InvokeCommissioning</a>(&amp;AppbdbCommissioningreq);
</pre>
<div class="section" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__SECTION_ILH_VLV_3TB"><h2 class="title sectiontitle">1. Touchlink commissioning</h2><p class="p">In this procedure, the node that initiates the touchlink operation is called the <strong class="ph b">initiator</strong> and the node that responds is called the <strong class="ph b">target</strong>. The initiator scans for nodes also supporting touchlink and if one is found establishes a new network with the target (if the initiator is not on a network) or adds the target to the network (if the initiator is already on a network) </p>
</div>
<div class="section" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__SECTION_JLH_VLV_3TB"><h2 class="title sectiontitle">2. Network Steering</h2><p class="p">There are two procedures in Network Steering. </p>
<table><tbody><tr><td class="td-dt"><dt class="dt dlterm">i. Network Steering when node is on a network </dt>
</td><td class="td-dd"><dd class="dd">A node that is already on a network opens up the network for a finite duration to allow other nodes to join </dd>
</td></tr><tr><td class="td-dt"><dt class="dt dlterm">ii. Network Steering when node is not on a network </dt>
</td><td class="td-dd"><dd class="dd">A node that is not already on a network scans for open networks and if a suitable one is found attempts to join. After joining the node is authenticated and receives the network key. Finally, if a Trust Center is present in the network, the node then exchanges its preconfigured link key for one generated by the Trust Center. </dd>
</td></tr></tbody></table></div>
<div class="section" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__SECTION_KLH_VLV_3TB"><h2 class="title sectiontitle">3. Network Formation</h2><p class="p">Zigbee coordinator node forms a centralized security network and activates its Trust Center functionality whereas a Zigbee router node forms a distributed security network.</p>
</div>
<div class="section" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__SECTION_LLH_VLV_3TB"><h2 class="title sectiontitle">4. Finding and Binding</h2><p class="p">There are two procedures in Finding and binding. </p>
<ul class="ul" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__UL_MLH_VLV_3TB"><li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-E3A6CAB0-9A52-4DD7-B0DD-501D3AE8D94C"><strong class="ph b">Finding and binding for a initiator endpoint:</strong> In this procedure, the initiator endpoint first searches for identifying target endpoints and if one is found, its simple descriptor is requested. The initiator endpoint then searches for any matching clusters between itself and the target endpoint and for each match found, it creates a corresponding entry in its binding table. If a group binding is requested, the initiator endpoint configures group membership of the target endpoint</li>
<li class="li" id="GUID-E048204C-1D49-45BD-B22A-AB073BD4DBC3__GUID-3A1EB97E-7C36-4C96-8C16-302F281F67D3"><strong class="ph b">Finding and binding for a target endpoint:</strong> In this procedure, the target endpoint identifies itself for a finite duration and then handles subsequent finding &amp; binding requests from an initiator endpoint</li>
</ul>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-FC956B9D-553C-4CEF-B7C2-73CCE741705B.html">BDB Component Usage</a></div>
</div>
</div></body>
</html>